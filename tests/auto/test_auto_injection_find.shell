. ./assert.sh
. /usr/bin/opentelemetry_shell.sh

n=3

directory="$(mktemp -d)"
for i in $(seq 1 $n); do \touch $directory/$i; done
expected="$(\find $directory -exec echo {} ';')"
actual="$(find $directory -exec echo {} ';')"
assert_equals "$expected" "$actual"
for i in $(seq 1 $n); do
  span="$(resolve_span ".name == \"/bin/echo $directory/$i\"")"
  assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | \jq -r '.kind')"
done

directory="$(mktemp -d)"
for i in $(seq 1 $n); do \touch $directory/$i; done
expected="$(\find $directory -exec echo {} '+')"
actual="$(find $directory -exec echo {} '+')"
assert_equals "$expected" "$actual"
for i in $(seq 1 $n); do
  span="$(resolve_span ".name == \"/bin/echo $directory/$i\"")"
  assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | \jq -r '.kind')"
done

directory="$(mktemp -d)"
for i in $(seq 1 $n); do \touch $directory/$i; done
expected="$(\find $directory -execdir echo {} ';')"
actual="$(find $directory -execdir echo {} ';')"
assert_equals "$expected" "$actual"
for i in $(seq 1 $n); do
  span="$(resolve_span ".name == \\"/bin/echo $directory/$i"\")"
  assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | \jq -r '.kind')"
done

directory="$(mktemp -d)"
for i in $(seq 1 $n); do \touch $directory/$i; done
expected="$(\find $directory -execdir echo {} '+')"
actual="$(find $directory -execdir echo {} '+')"
assert_equals "$expected" "$actual"
for i in $(seq 1 $n); do
  span="$(resolve_span ".name == \"/bin/echo $directory/$i"\")"
  assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | \jq -r '.kind')"
done

