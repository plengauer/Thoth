. ./assert.sh
. /usr/bin/opentelemetry_shell.sh

######
echo 0
assert_equals "foo" "$(sh -c 'echo $1' '' 'foo')"
echo 1
assert_equals "foo" "$(TEXT=foo sh -c 'echo $TEXT' '' 'foo')"
echo 2
my_print() { sh -c 'echo $TEXT'; }
assert_equals "foo" "$(TEXT=foo my_print)"
echo 3
my_print_2() { my_print; }
assert_equals "foo" "$(TEXT=foo my_print_2)"
######

time echo hello world
assert_equals 0 $?
span="$(resolve_span '.name == "time echo hello world"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"
span="$(resolve_span '.name == "echo hello world"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"

time -p echo hello world 2
assert_equals 0 $?
span="$(resolve_span '.name == "time -p echo hello world 2"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"
span="$(resolve_span '.name == "echo hello world 2"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"

file=$(mktemp)
time -o $file echo hello world 3
assert_equals 0 $?
span="$(resolve_span '.name == "'"time -o $file echo hello world 3"'"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"
span="$(resolve_span '.name == "echo hello world 3"')"
assert_equals "SpanKind.INTERNAL" "$(\echo "$span" | jq -r '.kind')"
